<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="万翼峰,万翼峰的学习笔记,学习笔记,前端,web,js,html,css,框架"><title>负载均衡解决方案 | 学习笔记</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">负载均衡解决方案</h1><a id="logo" href="/.">学习笔记</a><p class="description">学习是一种信仰!!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">负载均衡解决方案</h1><div class="post-meta">Feb 11, 2017<span> | </span><span class="category"><a href="/categories/杂文/">杂文</a></span></div><a data-thread-key="2017/02/11/负载均衡解决方案/" href="/2017/02/11/负载均衡解决方案/#comments" class="ds-thread-count"></a><div class="post-content"><p><strong>DNS 轮询</strong></p>
<p>　　DNS本身的机制不再赘述，这里主要看一看基于DNS的负载均衡，其大致原理很清楚，DNS系统本身支持同一个域名映射到多个ip (A记录）,例如</p>
<blockquote>
<p>　　niubility.com. IN A 172.168.1.101</p>
<p>　　IN A 172.168.1.102</p>
<p>　　IN A 172.168.1.103</p>
<p>　　IN A 172.168.1.104</p>
</blockquote>
<p>　　这样每次向DNS系统询问该域名的ip地址时（Tell Me The IP Address of niubility.com.），DNS会轮询(Round Robin)这个ip列表，每次给一个不同的ip，从而达到负载均衡的效果。</p>
<p>　　来看看这种负载均衡解决方案的优缺点</p>
<p>　　<strong>优点</strong></p>
<p>　　<strong>易于实现</strong></p>
<p>　　对于应用系统本身几乎没有任何侵入，配置也很简单，在某个文本里多加几行A记录就可以。尤其对于一个基于Web的系统来说更是如此，用户在浏览器里输入的URL host部分天然就是域名，所以在某个环节你必然有起码一台DNS服务器记录着这个域名对应的ip，所以可以说是基于已有域名系统(资产)就做到了负载均衡。</p>
<p>　　<strong>缺点</strong></p>
<p>　　<strong>会话粘连 (Session Sticky)</strong></p>
<p>　　客户端与目标系统之间一般存在会话的概念（不止是web系统的http session）, 其本质在于server端会或多或少的存一些客户端整个会话期间交互的身份识别以及数据信息，为了防止server端每次都对同一个客户端问一下，你是谁？系统会希望客户端在一个会话期间粘连在某个特定的serer上，除非这个server失败才failover到其它的server上，这种粘连特性对于server处理客户端请求处理的性能和客户端看到的数据一致性是有很大好处的。但是DNS负载均衡不能保证下一次请求会再次落在同一个server上。</p>
<p>　　<strong>DNS解析缓存和TTL带来的麻烦</strong></p>
<p>　　dns记录的缓存以及缓存失效时间都是个问题，在无线时代，通常来自手机的访问会经过称为行业网关的代理服务器，由于代理服务器会将域名解析的结果缓存一段时间，所以所有经由这个代理服务器的访问请求就全被解析到同一台服务器上去了，因此就可能无法实现均等分配需要处理的请求了。另外在后端集群的拓扑结构(副本数、部署位置、健康状态等)发生变化之后，dns配置的变化要等到网络上所有节点的缓存失效才能反馈出来，这带来的问题起码有2个，1是在等待失效过程中，完全不可控，没有办法加快这个进程，中美切换要花10分钟，因为要等网络所有几点对某些域名的TTL失效，2是滞后，有时候这种滞后是致命的，比如仍然有部分流量打到已经挂掉的那部分服务器上。</p>
<p>　　<strong>容错</strong></p>
<p>　　一个大型数据中心，每天都有机器坏了是很正常的事情，尤其是在虚拟化大行其道的今天，更是如此，相信你对虚拟主机又崩溃了一个，或者总是被同宿主机的猪一样的队友“挤”死这种情况一定不陌生。dns负载均衡的一大问题就在于这种情况下的容灾很麻烦，一是需要人工干预或者其他软件配合做健康监测，从dns配置中将无响应的机器或者崩溃的机器的相应的A记录删掉。一是删掉之后也要等到所有网络节点上的dns解析缓存失效，在这端时间内，很多访问系统的客户会受到影响。</p>
<p>　　<strong>数据热点</strong></p>
<p>　　dns是在域名层面做负载均衡，如果从web系统的请求URL角度讲，不同的URL对后端server的压力强度不一样，dns负载很可能会出现所有高强度的请求全都被打到小部分服务器甚至同一台上去了的情况，这个问题的可怕性不在于风险，而在于风险完全不可控。</p>
<h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><p>　<strong>引入负载均衡器</strong></p>
<p>　　客户端 -&gt; LB -&gt; replica1,replica2,replica3</p>
<p>​    LB负责客户端流量到后端服务集群的分发，一般LB也会负责后端所有server的健康监测</p>
<p>　    <strong>优点</strong></p>
<p>　　可以在LB里面做集中的分发逻辑，可以有多种分发方式，例如最常见的Round Robin, Random Robin, Weight-Based Round Robin等。</p>
<p>　　<strong>缺点</strong></p>
<p>　　LB是单点,</p>
<p>摘抄至 <a href="http://mt.sohu.com/20160607/n453396368.shtml" target="_blank" rel="noopener">http://mt.sohu.com/20160607/n453396368.shtml</a></p>
</div><div class="tags"><a href="/tags/服务器/">服务器</a></div><div class="post-nav"><a href="/2017/02/12/移动端常见问题总结 /" class="pre">移动端web开发常见问题</a><a href="/2017/02/10/优雅降级和渐进增强/" class="next">优雅降级和渐进增强</a></div><div data-thread-key="2017/02/11/负载均衡解决方案/" data-title="负载均衡解决方案" data-url="http://www.wanyifeng.top/2017/02/11/负载均衡解决方案/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div id="comments"><div data-thread-key="2017/02/11/负载均衡解决方案/" data-title="负载均衡解决方案" data-url="http://www.wanyifeng.top/2017/02/11/负载均衡解决方案/" data-author-key="1" class="ds-thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bootstrap/">Bootstrap</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ajax/">ajax</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/canvas/">canvas</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jQuery/">jQuery</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂文/">杂文</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/构建工具/">构建工具</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动端/">移动端</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/轮子/">轮子</a><span class="category-list-count">14</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Bootstrap/" style="font-size: 15px;">Bootstrap</a> <a href="/tags/ajax/" style="font-size: 15px;">ajax</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/构建工具/" style="font-size: 15px;">构建工具</a> <a href="/tags/jsonp/" style="font-size: 15px;">jsonp</a> <a href="/tags/继承/" style="font-size: 15px;">继承</a> <a href="/tags/轮子/" style="font-size: 15px;">轮子</a> <a href="/tags/MV/" style="font-size: 15px;">MV*</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/兼容/" style="font-size: 15px;">兼容</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/canvas/" style="font-size: 15px;">canvas</a> <a href="/tags/能力检测/" style="font-size: 15px;">能力检测</a> <a href="/tags/innerText/" style="font-size: 15px;">innerText</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/杂文/" style="font-size: 15px;">杂文</a> <a href="/tags/服务器搭建/" style="font-size: 15px;">服务器搭建</a> <a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/移动端/" style="font-size: 15px;">移动端</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/22/音视频即时通讯服务器搭建/">音视频即时通讯服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/精度丢失问题解决方法/">JS数字精度丢失的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/10/svn-ubuntu服务器/">svn服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/05/JSON数据变化diff算法JS/">json数据diff方法（js）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/05/动态加载js/">文件大小单位装换</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/05/文件大小单位装换/">文件大小单位装换</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/04/es6/">es6简单梳理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/03/简单sql入门(一)/">SQL入门(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/30/CSS3/">css3小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/30/python基础篇(二)/">python基础篇(二)</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-commt"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<span>联系博主：<a href="https://github.com/WanYiFeng" target="_blank" class="fa fa-github"> </a></span></p><p><span> 作者: &copy; <a href="/." rel="nofollow">万翼峰</a></span></p></div></div></div><script>var duoshuoQuery = {short_name:'wanyifeng'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script></body></html>